# =============================================================================
# MakeAnon - Email Masking Service Configuration
# =============================================================================

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------
PORT=3000
HOST=0.0.0.0
NODE_ENV=development

# Base URL for links in emails (verification, management)
BASE_URL=https://makeanon.yourdomain.com

# -----------------------------------------------------------------------------
# Email Encryption (REQUIRED for privacy)
# -----------------------------------------------------------------------------
# 32-byte key for encrypting destination emails in the database
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# IMPORTANT: Keep this secret! If lost, encrypted emails cannot be recovered.
MASTER_ENCRYPTION_KEY=

# -----------------------------------------------------------------------------
# Database (PostgreSQL)
# -----------------------------------------------------------------------------
DATABASE_URL="postgresql://user:password@localhost:5432/emask?schema=public"

# -----------------------------------------------------------------------------
# Redis (for caching and rate limiting)
# -----------------------------------------------------------------------------
REDIS_URL="redis://localhost:6379"
REDIS_PREFIX="emask:"

# -----------------------------------------------------------------------------
# JWT Configuration
# -----------------------------------------------------------------------------
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production-min-32-chars
JWT_EXPIRES_IN=7d

# -----------------------------------------------------------------------------
# Admin Configuration
# -----------------------------------------------------------------------------
# Initial admin email (created on first run)
ADMIN_EMAIL=admin@yourdomain.com
ADMIN_PASSWORD=change-this-secure-password

# -----------------------------------------------------------------------------
# Email Domains
# -----------------------------------------------------------------------------
# Comma-separated list of domains available for aliases
# The first domain is the default
EMAIL_DOMAINS=mask.example.com,hide.example.com,alias.example.com

# -----------------------------------------------------------------------------
# SMTP Server Configuration (for receiving emails)
# -----------------------------------------------------------------------------
SMTP_PORT=25
SMTP_HOST=0.0.0.0
SMTP_ENABLED=true

# TLS Configuration (recommended for production)
SMTP_TLS_ENABLED=false
SMTP_TLS_KEY_PATH=/path/to/key.pem
SMTP_TLS_CERT_PATH=/path/to/cert.pem

# -----------------------------------------------------------------------------
# Outbound SMTP Configuration (for forwarding emails)
# Configure these with your email provider
# Supports: Gmail, SendGrid, Mailgun, AWS SES, Postmark, etc.
# -----------------------------------------------------------------------------
SMTP_OUTBOUND_HOST=smtp.gmail.com
SMTP_OUTBOUND_PORT=587
SMTP_OUTBOUND_SECURE=false
SMTP_OUTBOUND_USER=your-email@gmail.com
SMTP_OUTBOUND_PASS=your-app-password

# From address for system emails (verification, notifications)
SMTP_FROM_ADDRESS=noreply@yourdomain.com
SMTP_FROM_NAME=Emask

# -----------------------------------------------------------------------------
# Rate Limiting
# -----------------------------------------------------------------------------
# API rate limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# Alias creation limits (per destination email per hour)
ALIAS_CREATION_LIMIT_PER_HOUR=10

# Email forwarding limits (per alias per minute)
FORWARD_LIMIT_PER_MINUTE=30

# -----------------------------------------------------------------------------
# Alias Configuration
# -----------------------------------------------------------------------------
# Maximum aliases per unregistered email
MAX_ALIASES_PER_EMAIL=10

# Maximum aliases per registered user
MAX_ALIASES_PER_USER=100

# Maximum aliases for premium users
MAX_ALIASES_PREMIUM=1000

# Alias string length
ALIAS_LENGTH=8

# Allow custom alias names (user-chosen)
ALLOW_CUSTOM_ALIASES=true

# Minimum custom alias length
MIN_CUSTOM_ALIAS_LENGTH=4

# -----------------------------------------------------------------------------
# Security
# -----------------------------------------------------------------------------
# Require email verification before forwarding
REQUIRE_EMAIL_VERIFICATION=true

# Management token expiry (for public aliases)
MANAGEMENT_TOKEN_EXPIRY_DAYS=365

# Session timeout for logged-in users
SESSION_TIMEOUT_HOURS=24

# Allowed CORS origins (comma-separated, * for all)
CORS_ORIGINS=*

# -----------------------------------------------------------------------------
# Email Verification
# -----------------------------------------------------------------------------
# Token expiry time
VERIFICATION_TOKEN_EXPIRY_HOURS=24

# Resend cooldown (seconds)
VERIFICATION_RESEND_COOLDOWN=60

# -----------------------------------------------------------------------------
# Webhooks
# -----------------------------------------------------------------------------
WEBHOOKS_ENABLED=true
WEBHOOK_TIMEOUT_MS=5000
WEBHOOK_MAX_RETRIES=3

# -----------------------------------------------------------------------------
# Spam Protection
# -----------------------------------------------------------------------------
# Block disposable email domains for destination
BLOCK_DISPOSABLE_EMAILS=false

# Maximum email size to forward (bytes)
MAX_EMAIL_SIZE_BYTES=26214400

# Enable spam scoring (requires SpamAssassin)
SPAM_CHECK_ENABLED=false
SPAM_THRESHOLD=5.0

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
LOG_LEVEL=info
LOG_FORMAT=json

# Email activity logging: NONE, PRIVATE, PUBLIC, ALL
# NONE = no email logs stored in database
# PRIVATE = only log emails to private aliases (owned by registered users)
# PUBLIC = only log emails to public aliases (anonymous/unregistered)
# ALL = log all email activity (default)
LOG=ALL

# Log file paths (optional)
LOG_FILE_ERROR=/var/log/emask/error.log
LOG_FILE_COMBINED=/var/log/emask/combined.log

# -----------------------------------------------------------------------------
# Monitoring
# -----------------------------------------------------------------------------
# Health check endpoint
HEALTH_CHECK_PATH=/health

# Metrics endpoint (Prometheus format)
METRICS_ENABLED=true
METRICS_PATH=/metrics

# -----------------------------------------------------------------------------
# Cleanup Jobs
# -----------------------------------------------------------------------------
# Clean expired tokens interval (hours)
CLEANUP_INTERVAL_HOURS=1

# Delete inactive aliases after (days, 0 to disable)
DELETE_INACTIVE_AFTER_DAYS=0

# Delete expired aliases
DELETE_EXPIRED_ALIASES=true

# Log retention (days)
LOG_RETENTION_DAYS=30
